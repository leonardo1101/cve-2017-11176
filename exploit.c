#include <mqueue.h>
#include <signal.h>
#include <stdio.h>
#include <string.h>


//Size of userland memory that mq_notify must read
#define NOTIFY_COOKIE_LEN (32)

int main(void)
{
    struct sigevent sigeve;
    char sinval_buffer_user[NOTIFY_COOKIE_LEN];
    
    //Initialize the sigevent struct
    memset(&sigeve, 0, sizeof(sigeve));
    
    //Setting the values of sigevent to reach thre retry logic
    sigeve.sigev_notify = SIGEV_THREAD;
    sigeve.sigev_value.sival_ptr = sinval_buffer_user;
    
    if (mq_notify((mqd_t)-1, &sigeve))
      {
        perror("mqnotify");
        goto fail;
      }
      printf("mqnotify succeed\n");

      // TODO: exploit

      return 0;

    fail:
      printf("exploit failed!\n");
      return -1;    
}
